[назад](../README.md)

# Краткое описание процесса работы над сервисом 

## 1. Анализ требований и формирование доменной модели (Domain-Driven Design)

1. **Сбор и осмысление требований**

- Проанализировать все функциональные (FR) и нефункциональные (NFR) требования, перечисленные в спецификации.
- Убедиться, что система покрывает:
    - Сокращение ссылок (уникальность для разных пользователей).
    - Лимит переходов с блокировкой.
    - Ограничение времени жизни и автоматическое удаление «протухших» ссылок.
    - Уведомления, идентификацию по UUID, права доступа (редактирование/удаление) и т.д.

2. **Определение доменных сущностей (Entities) и Value Objects**

- **Сущность `User`** (идентифицируется `UUID`).
- **Сущность `Link`** (уникальный идентификатор ссылки, связан с `User`).
- **Value Objects**: `ShortURL`, `OriginalURL`, `MaxRedirectsLimit`, `ExpirationDate` и т.д.
- Доменная логика: что происходит, когда истекает срок жизни ссылки, или исчерпывается лимит переходов.

3. **Ubiquitous Language (единый язык)**

- Зафиксировать термины: «короткая ссылка», «лимит переходов», «время жизни», «протухшая ссылка», «автоматическое
  удаление» и т.д., чтобы все участники разработки понимали их одинаково.

---

## 2. Ограничение контекста и проектирование модулей (Bounded Context)

1. **Определение контекста**

- В рамках учебного проекта весь функционал (управление ссылками, пользователями, уведомлениями) может находиться в
  одном контексте.
- Возможное разбиение на более мелкие контексты (например, «Управление пользователями» и «Управление ссылками») при
  увеличении масштаба.

2. **Границы ответственности**

- «Сервис сокращения ссылок» (короткие ссылки, их жизненный цикл).
- «Сервис идентификации и прав доступа» (привязка UUID к пользователям).
- «Сервис уведомлений» (отправка сообщений в консоль).

---

## 3. Формирование приложения по принципам чистой архитектуры

1. **Слой Domain**

- **Entities**: `Link`, `User`.
- **Value Objects**: `CustomUUID`, `ShortURL`, `MaxRedirectsLimit`, `ExpirationDate`.
- Методы и инварианты (например, `Link.isActive()`, `Link.incrementRedirectCount()`, `Link.isExpired()`).
- Правила: при превышении лимита или истечении срока — помечаем ссылку неактивной (или удаляем).

2. **Слой Application (Use Cases)**

- **Use Case**: «Создать короткую ссылку» (генерация `shortUrl`, назначение пользователя, сохранение в репозиторий).
- **Use Case**: «Редактировать лимит переходов» (проверка владельца, обновление `maxRedirects`).
- **Use Case**: «Удалить ссылку» (проверка доступа, удаление из репозитория).
- **Use Case**: «Перейти по короткой ссылке» (инкремент счётчика, проверка `isExpired()`/лимита, возможно удаление при
  следующем клике).
- **Use Case**: «Список ссылок пользователя» и т.д.
- В DDD это могут быть **Application Services**, которые оперируют сущностями и репозиториями.

3. **Слой Interface (CLI / Controllers)**

- **CommandLineInterface** (консольный UI): принимает команды `create`, `edit`, `delete`, `redirect`, `list`.
- **Controllers** (например, `LinkController`, `AuthController`): вызывают соответствующие Use Case.
- Проверяют ввод (включая UUID), взаимодействуют с Use Case, возвращают результат/сообщение пользователю.

4. **Слой Infrastructure**

- **Реализация репозиториев** (In-memory).
- **Сервис генерации коротких ссылок** (хеш, кодирование).
- **Конфигурационный сервис** (чтение `config.properties`: время жизни ссылки, дефолтный лимит переходов и т.д.).
- **Система уведомлений** (в данном случае — консольный вывод, но при расширении можно добавить e-mail).

---

## 4. Реализация основных функциональных требований

1. **Сокращение ссылок**

- Use Case «CreateShortLink»: принимает `OriginalURL`, `UserUUID`, опциональные параметры (`desiredMaxRedirects`,
  `desiredLifetime`). Применяет правила из конфигурации (берёт большее из лимитов, меньшее из сроков), сохраняет новую
  сущность `Link`.

2. **Лимит переходов**

- Каждая сущность `Link` хранит `maxRedirects` и `redirectCount`.
- Use Case «RedirectLink»: если `redirectCount >= maxRedirects`, при попытке очередного перехода ссылка удаляется или
  помечается неактивной.

3. **Время жизни ссылки**

- Каждая ссылка имеет `expirationDate`.
- Use Case «RedirectLink» или «CheckAndRemoveExpiredLinks»: при попытке перейти после `expirationDate` — ссылка
  удаляется.

4. **Уведомление пользователя**

- При недоступности ссылки (`limitReached` или `expired`) Use Case формирует уведомление, которое передаётся через
  `NotificationService` → в консоль.

5. **Идентификация пользователя по UUID**

- `AuthController` (или аналог) проверяет, есть ли у пользователя валидный UUID; если нет, генерирует новый.
- Все операции над ссылкой требуют соответствия `Link.userUUID` и текущего UUID пользователя.

6. **Консольное управление**

- `CommandLineInterface` вызывает контроллеры, которые обращаются к Use Cases.
- Пользователь вводит команды: `create`, `edit`, `delete`, `redirect`, `list`, `exit`.
- При каждом вводе UUID/shortURL происходит проверка валидности и прав.

---

## 5. Тестирование и отладка

> Тестирование проведено вручную. 
> Выполнены проверки на соответствие требованиям ТЗ

---

## 6. Итоговая структура кода и развёртывание

1. **Пакеты (пример)**

- `domain` (Entities, Value Objects)
- `application` (Use Cases, Interfaces для репозиториев)
- `infrastructure` (Repository In-memory, Config, NotificationService)
- `presentation` (CLI, Controllers, DTOs)

2. **Конфигурация**

- `config.properties`: параметры `defaultMaxRedirects`, `defaultLifetimeHours`, пр.
- Механизм чтения файла при запуске приложения (без изменения исходного кода).

3. **Запуск**

- Для демонстрации достаточно `java -jar shortify.jar` (или команда Maven/Gradle).
- Пользователи взаимодействуют с CLI, генерируют UUID, создают/редактируют ссылки, делают переходы.

4. **Размещение на GitHub**

- Репозиторий с исходным кодом, документацией (Readme и проектные документы).
- Для проверки кода и запуска менторам или коллегам достаточно клонировать проект и запустить.

---

## 7. Резюме выполнения проекта

1. **DDD-подход**

- Описаны **доменные модели** (`Link`, `User`) и **Value Objects**, определены правила (ограничения по лимиту и сроку).
- Каждая операция (Use Case) отражает ключевой бизнес-процесс: создание, редактирование, переход, удаление ссылки.

2. **Принципы чистой архитектуры**

- Разделение **Domain** (бизнес-логика) и **Application** (use cases) от **Infrastructure** (репозиторий, конфиг).
- Лёгкость замены хранилища (in-memory → БД) или интерфейса (CLI → веб-UI).

3. **Реализация всего, что в ТЗ**

- **Уникальные короткие ссылки** для разных пользователей.
- **Лимит переходов** с блокировкой и уведомлением.
- **Время жизни** (с удалением «протухших» ссылок).
- **Идентификация по UUID** и права доступа (создатель → редактирование).
- **Работа нескольких пользователей**, создание нескольких ссылок.
- **Консольное управление** (create, edit, delete, redirect, list), уведомления в консоль.

---

Данный перечень отражает **целостный процесс** работы над проектом:

- от детального анализа требований,
- через формирование **доменной** (DDD) модели и применение **чистой архитектуры** (отделение слоёв),
- до реализации **Use Cases**,
- тестирования,
- и итогового развертывания (представленного в GitHub-репозитории).

Таким образом, вся функциональность (сокращение ссылок, лимит, время жизни, уведомления, UUID) выстроена в виде *
*понятной архитектуры**, что позволит легко поддерживать и развивать проект в будущем.